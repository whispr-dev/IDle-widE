@echo off
rem ==================== build.bat ====================
rem Anti-loop guard
if defined WOFL_BUILD_RUNNING (
    echo ERROR: Detected recursive call to build.bat! Check for 'call build.bat' or similar.
    exit /b 1
)
set WOFL_BUILD_RUNNING=1

echo ========================================
echo Building WOFL Ultra-Minimal IDE
echo ========================================
echo Checking for source files...

if not exist src\syntax_asm.c echo WARNING: src\syntax_asm.c not found - skipping

echo Compiling...
cl /W4 /Fe:wofl.exe src\*.c /link user32.lib gdi32.lib
if %ERRORLEVEL% NEQ 0 (
    echo ========================================
    echo BUILD FAILED
    echo ========================================
    echo Please check:
    echo 1. All source files exist in src\ directory
    echo 2. editor.h has matching #ifndef/#endif
    echo 3. File names match (cmd_palette.c vs command_palette.c)
    echo ========================================
    set WOFL_BUILD_RUNNING=
    exit /b 1
)
echo ========================================
echo BUILD SUCCEEDED
echo ========================================
set WOFL_BUILD_RUNNING=
exit /b 0